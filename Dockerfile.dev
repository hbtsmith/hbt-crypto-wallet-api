# Usa imagem base com Node
FROM node:24-bullseye

# Habilita o Corepack (gerenciador de Yarn/Pnpm inclu√≠do no Node.js)
RUN corepack enable

# Garante a vers√£o espec√≠fica do Yarn
RUN corepack prepare yarn@4.6.0 --activate

# Cria diret√≥rio de trabalho
WORKDIR /app

# Copia arquivos de depend√™ncia
COPY package.json yarn.lock .yarnrc.yml ./

# üõ†Ô∏è Define vari√°veis de ambiente para Prisma (antes do generate)
#ENV PRISMA_QUERY_ENGINE_LIBRARY=/app/node_modules/@prisma/client/libquery_engine-linux-musl-arm64-openssl-3.0.x.so.node
#ENV PRISMA_QUERY_ENGINE_BINARY=/app/node_modules/prisma/engines/query-engine-linux-musl-arm64
#ENV PRISMA_CLI_QUERY_ENGINE_TYPE=binary
# Instala as depend√™ncias com Yarn 4
RUN yarn install


# Copia todo o projeto
COPY . .

# Gera o Prisma Client ap√≥s instalar depend√™ncias
RUN yarn prisma generate

# Exp√µe a porta da aplica√ß√£o
EXPOSE 3000


# Comando para iniciar o servidor
CMD ["yarn", "dev"]
